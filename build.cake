#addin "Cake.Git"

//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("Test", "Test");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Test")
    .Does(() =>
{
    var result = GitLogTip(".");
    Information(result.Message);


    string pat = @"(test|hotfix|release)\/(\d+\.\d+\.\d+)";

    // Instantiate the regular expression object.
    System.Text.RegularExpressions.Regex r = new System.Text.RegularExpressions.Regex(pat, System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // Match the regular expression pattern against a text string.
    System.Text.RegularExpressions.Match m = r.Match(result.Message);
    
    var solutionFolder = ".";

    Information(m.Value);
 
    GitTag(solutionFolder, m.Value);
    GitPushRef(solutionFolder, "dubravko.ban@gmail.com", "###", "origin", m.Value); 
});


//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);
