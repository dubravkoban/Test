#addin "Cake.Git"

//////////////////////////////////////////////////////////////////////
// ARGUMENTS
//////////////////////////////////////////////////////////////////////

var target = Argument("Test", "Test");

//////////////////////////////////////////////////////////////////////
// PREPARATION
//////////////////////////////////////////////////////////////////////


//////////////////////////////////////////////////////////////////////
// TASKS
//////////////////////////////////////////////////////////////////////

Task("Test")
    .Does(() =>
{
    var result = GitLogTip(".");
    Information(result.Message);


    string pat = @"(\d+\.\d+\.\d+)";

    // Instantiate the regular expression object.
    System.Text.RegularExpressions.Regex r = new System.Text.RegularExpressions.Regex(pat, System.Text.RegularExpressions.RegexOptions.IgnoreCase);

    // Match the regular expression pattern against a text string.
    System.Text.RegularExpressions.Match m = r.Match(result.Message);

    var versionTag = m.Value + ".999";
    var solutionFolder = ".";

    Information(versionTag);

    GitTag(solutionFolder, versionTag);
    GitPushRef(solutionFolder, "dubravko.ban@gmail.com", "L1bus0ft", "origin", versionTag); 
});


//////////////////////////////////////////////////////////////////////
// EXECUTION
//////////////////////////////////////////////////////////////////////

RunTarget(target);
